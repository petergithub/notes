<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0059)http://blog.csdn.net/heyongluoyao8/article/details/51413668 -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

 <meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" media="handheld" href="http://blog.csdn.net/heyongluoyao8/article/details/51413668#">

    <title>服务器监控(包括性能指标与web应用程序) - 我和我追逐的梦~~~
        - 博客频道 - CSDN.NET</title>

    <meta name="description" content="bind Function----The bind function associates a local address with a socket.int bind(  __in  SOCKET s,  __in  const struct sockaddr *name,">
        <!--new top-->

        <link rel="stylesheet" href="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/index.css">
        <!--new top-->

    <link rel="Stylesheet" type="text/css" href="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/style.css">
    <link id="RSSLink" title="RSS" type="application/rss+xml" rel="alternate" href="http://blog.csdn.net/heyongluoyao8/rss/list">
    <link rel="shortcut icon" href="http://c.csdnimg.cn/public/favicon.ico">
    <link type="text/css" rel="stylesheet" href="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/blue.css">

<link rel="stylesheet" type="text/css" href="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/job_reco.css"><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Hover_Arrow {position: absolute; width: 15px; height: 11px; cursor: pointer}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; color: #666666}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_Menu_Close {position: absolute; width: 31px; height: 31px; top: -15px; left: -15px}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><link href="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/bdsstyle.css" rel="stylesheet" type="text/css"><link rel="stylesheet" type="text/css" href="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/style(1).css"><link type="text/css" rel="stylesheet" href="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/style(2).css"><script src="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/logger.js"></script><style id="style-1-cropbar-clipper">/* Copyright 2014 Evernote Corporation. All rights reserved. */
.en-markup-crop-options {
    top: 18px !important;
    left: 50% !important;
    margin-left: -100px !important;
    width: 200px !important;
    border: 2px rgba(255,255,255,.38) solid !important;
    border-radius: 4px !important;
}

.en-markup-crop-options div div:first-of-type {
    margin-left: 0px !important;
}
</style>
</head>
<body>
    <div id="container">
</div>

        <div id="body">
            <div id="main">
                <div class="main">

<link rel="stylesheet" href="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/markdown_views.css">


<div id="article_details" class="details">
    <div class="article_title">
         <span class="ico ico_type_Original"></span>


    <h1>
        <span class="link_title"><a href="http://blog.csdn.net/heyongluoyao8/article/details/51413668">
        <font color="red">[置顶]</font>
        服务器监控(包括性能指标与web应用程序)
        </a></span>
    </h1>
</div>



        <div class="article_manage clearfix">
        <div class="article_l">
            <span class="link_categories">
            标签：
              <a href="http://www.csdn.net/tag/%e6%9c%8d%e5%8a%a1%e5%99%a8" target="_blank" onclick="_gaq.push([&#39;_trackEvent&#39;,&#39;function&#39;, &#39;onclick&#39;, &#39;blog_articles_tag&#39;]);">服务器</a><a href="http://www.csdn.net/tag/nginx" target="_blank" onclick="_gaq.push([&#39;_trackEvent&#39;,&#39;function&#39;, &#39;onclick&#39;, &#39;blog_articles_tag&#39;]);">nginx</a><a href="http://www.csdn.net/tag/%e7%9b%91%e6%8e%a7" target="_blank" onclick="_gaq.push([&#39;_trackEvent&#39;,&#39;function&#39;, &#39;onclick&#39;, &#39;blog_articles_tag&#39;]);">监控</a><a href="http://www.csdn.net/tag/%e6%80%a7%e8%83%bd" target="_blank" onclick="_gaq.push([&#39;_trackEvent&#39;,&#39;function&#39;, &#39;onclick&#39;, &#39;blog_articles_tag&#39;]);">性能</a><a href="http://www.csdn.net/tag/%e5%bc%82%e5%b8%b8" target="_blank" onclick="_gaq.push([&#39;_trackEvent&#39;,&#39;function&#39;, &#39;onclick&#39;, &#39;blog_articles_tag&#39;]);">异常</a>
            </span>
        </div>
        <div class="article_r">
            <span class="link_postdate">2016-05-16 14:25</span>
            <span class="link_view" title="阅读次数">12007人阅读</span>
            <span class="link_comments" title="评论次数"> <a href="http://blog.csdn.net/heyongluoyao8/article/details/51413668#comments" onclick="_gaq.push([&#39;_trackEvent&#39;,&#39;function&#39;, &#39;onclick&#39;, &#39;blog_articles_pinglun&#39;])">评论</a>(0)</span>
            <span class="link_collect tracking-ad" data-mod="popu_171"> <a href="javascript:void(0);" onclick="javascript:collectArticle(&#39;服务器监控(包括性能指标与web应用程序)&#39;,&#39;51413668&#39;);return false;" title="收藏">收藏</a></span>
             <span class="link_report"> <a href="http://blog.csdn.net/heyongluoyao8/article/details/51413668#report" onclick="javascript:report(51413668,2);return false;" title="举报">举报</a></span>

        </div>
    </div>
    <div class="embody" style="display:none" id="embody">
        <span class="embody_t">本文章已收录于：</span>
        <div class="embody_c" id="lib" value="{&quot;err&quot;:0,&quot;msg&quot;:&quot;ok&quot;,&quot;data&quot;:[]}"></div>
    </div>
    <style type="text/css">
            .embody{
                padding:10px 10px 10px;
                margin:0 -20px;
                border-bottom:solid 1px #ededed;
            }
            .embody_b{
                margin:0 ;
                padding:10px 0;
            }
            .embody .embody_t,.embody .embody_c{
                display: inline-block;
                margin-right:10px;
            }
            .embody_t{
                font-size: 12px;
                color:#999;
            }
            .embody_c{
                font-size: 12px;
            }
            .embody_c img,.embody_c em{
                display: inline-block;
                vertical-align: middle;
            }
             .embody_c img{
                width:30px;
                height:30px;
            }
            .embody_c em{
                margin: 0 20px 0 10px;
                color:#333;
                font-style: normal;
            }
    </style>
      <div class="category clearfix">
        <div class="category_l">
           <img src="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/category_icon.jpg">
            <span>分类：</span>
        </div>
        <div class="category_r">
                    <label onclick="GetCategoryArticles(&#39;6218683&#39;,&#39;heyongluoyao8&#39;,&#39;top&#39;,&#39;51413668&#39;);">
                        <span onclick="_gaq.push([&#39;_trackEvent&#39;,&#39;function&#39;, &#39;onclick&#39;, &#39;blog_articles_fenlei&#39;]);">web服务器<em>（1）</em></span>
                      <img class="arrow-down" src="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/arrow_triangle _down.jpg" style="display:inline;">
                      <img class="arrow-up" src="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/arrow_triangle_up.jpg" style="display:none;">
                        <div class="subItem">
                            <div class="subItem_t"><a href="http://blog.csdn.net/heyongluoyao8/article/category/6218683" target="_blank">作者同类文章</a><i class="J_close">X</i></div>
                            <ul class="subItem_l" id="top_6218683">
                            </ul>
                        </div>
                    </label>
        </div>
    </div>
        <div class="bog_copyright">
            <p class="copyright_p">版权声明：未经许可, 不能转载</p>
        </div>


<div style="clear:both"></div><div style="border:solid 1px #ccc; background:#eee; float:left; min-width:200px;padding:4px 10px;"><p style="text-align:right;margin:0;"><span style="float:left;">目录<a href="http://blog.csdn.net/heyongluoyao8/article/details/51413668#" title="系统根据文章中H1到H6标签自动生成文章目录">(?)</a></span><a href="http://blog.csdn.net/heyongluoyao8/article/details/51413668#" onclick="javascript:return openct(this);" title="展开">[+]</a></p><ol style="display:none;margin-left:14px;padding-left:14px;line-height:160%;"><li><a href="http://blog.csdn.net/heyongluoyao8/article/details/51413668#t0">服务器监控</a></li><ol><li><a href="http://blog.csdn.net/heyongluoyao8/article/details/51413668#t1">服务运行监控</a></li><li><a href="http://blog.csdn.net/heyongluoyao8/article/details/51413668#t2">机器性能指标</a></li><ol><li><a href="http://blog.csdn.net/heyongluoyao8/article/details/51413668#t3">指标</a></li><li><a href="http://blog.csdn.net/heyongluoyao8/article/details/51413668#t4">CPU</a></li><li><a href="http://blog.csdn.net/heyongluoyao8/article/details/51413668#t5">Memory</a></li><li><a href="http://blog.csdn.net/heyongluoyao8/article/details/51413668#t6">磁盘</a></li><li><a href="http://blog.csdn.net/heyongluoyao8/article/details/51413668#t7">磁盘IO</a></li><li><a href="http://blog.csdn.net/heyongluoyao8/article/details/51413668#t8">网络IO</a></li><li><a href="http://blog.csdn.net/heyongluoyao8/article/details/51413668#t9">连接数</a></li><li><a href="http://blog.csdn.net/heyongluoyao8/article/details/51413668#t10">文件句柄数</a></li><li><a href="http://blog.csdn.net/heyongluoyao8/article/details/51413668#t11">性能指标总结</a></li></ol><li><a href="http://blog.csdn.net/heyongluoyao8/article/details/51413668#t12">总结</a></li><li><a href="http://blog.csdn.net/heyongluoyao8/article/details/51413668#t13">参考</a></li></ol></ol></div><div style="clear:both"></div><div id="article_content" class="article_content">
        <div class="markdown_views"><h2 id="服务器监控"><a name="t0"></a>服务器监控</h2>

<p>   在搭建服务器时，除了部署webapp之外，还需要服务的异常信息与服务器性能指标进行监控，一旦有异常则通知管理员。 <br>
   服务器使用<a href="http://lib.csdn.net/base/linux" class="replace_word" title="Linux知识库" target="_blank" style="color:#df3434; font-weight:bold;">Linux</a>+Nginx-1.9.15+Tomcat7+<a href="http://lib.csdn.net/base/javaee" class="replace_word" title="Java EE知识库" target="_blank" style="color:#df3434; font-weight:bold;">Java</a>搭建的。 <br>
   编写脚本检测错误日志和服务器性能指标，一旦新生错误日志或者性能降低到设定的阈值时，则使用云监控将报警上传到云账号。</p>

<h3 id="服务运行监控"><a name="t1"></a>服务运行监控</h3>

<p>    错误日志包含以下三个方面：</p>

<ul>
<li>nginx 错误信息监控(nginx.conf配置) <br>
<ul><li>${NGINX_HOME}/logs/error.log</li></ul></li>
<li>tomcat 错误信息监控(server.xml配置) <br>
<ul><li>${TOMCAT_HOME}/logs/catalina.out </li></ul></li>
<li>webapp错误信息监控(log4j) <br>
<ul><li>${WEBAPP_HOME}/log/error</li></ul></li>
</ul>



<h3 id="机器性能指标"><a name="t2"></a>机器性能指标</h3>

<p>    一般都会使用linux系统的机器作为服务器，那么当在上面搭建服务时，需要对一些常用的性能指标进行监控，那么一般包含哪些指标呢？下面对其进行一些总结，欢迎补充…</p>



<h4 id="指标"><a name="t3"></a>指标</h4>

<ul>
<li>CPU(Load) CPU使用率/负载</li>
<li>Memory 内存</li>
<li>Disk 磁盘空间</li>
<li>Disk I/O 磁盘I/O</li>
<li>Network I/O 网络I/O</li>
<li>Connect Num 连接数</li>
<li>File Handle Num 文件句柄数 <br>
…</li>
</ul>



<h4 id="cpu"><a name="t4"></a>CPU</h4>

<ol>
<li><p>说明 <br>
    机器的CPU占有率越高，说明机器处理越忙，运算型任务越多。一个任务可能不仅会有运算部分，还会有I/O(磁盘I/O与网络I/O)部分，当在处理I/O时，时间片未完其CPU也会释放，因此某个时间点的CPU占有率没有太大的意义，因此需要计算一段时间内的平均值，那么平均负载(Load Average)这个指标便能很好得对其进行表征。平均负载：它是根据一段时间内占有CPU的进程数目和等待CPU的进程数目计算出来的，其中等待CPU的进程不包括处于wait状态的进程，比如在等待I/O的进程，即指那些就绪状态的进程，运行只缺CPU这个资源。具体如何计算可以参见Linux内核代码，计算出一个数之后，然后除以CPU核数，结果：</p>

<ul><li>&lt;=3 则系统性能较好。</li>
<li>&lt;=4 则系统性能可以，可以接收。</li>
<li>&gt;5 则系统性能负载过重，可能会发生严重的问题，那么就需要扩容了，要么增加核，要么分布式集群。</li></ul></li>
<li><p>查看命令</p>

<ul><li><code>vmstat</code> <br>
<code>vmstat n m</code> <br>
n表示每隔n秒采集一次，m表示一共采集多少次，如果m没有，那么会一直采集下去. 在终端键入 <code>vmstat 5</code> <br>
<img src="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/20160514235813033" alt="Alt text" title=""> <br>
结果各字段解释如下(这里只解释与CPU相关的)： <br>
r：表示运行队列(就是说多少个进程真的分配到CPU)，当这个值超过了CPU数目，就会出现CPU瓶颈了。这个也和top的负载有关系，一般负载超过了3就比较高，超过了5就高，超过了10就不正常了，服务器的状态很危险。top的负载类似每秒的运行队列。如果运行队列过大，表示你的CPU很繁忙，一般会造成CPU使用率很高。 <br>
b：表示阻塞的进程，如在等待I/O请求。 <br>
in：每秒CPU的中断次数，包括时间中断。 <br>
cs：每秒上下文切换次数，例如我们调用系统函数，就要进行上下文切换，线程的切换，也要进程上下文切换，这个值要越小越好，太大了，要考虑调低线程或者进程的数目，例如在apache和nginx这种web服务器中，我们一般做性能测试时会进行几千并发甚至几万并发的测试，选择web服务器的进程可以由进程或者线程的峰值一直下调，压测，直到cs到一个比较小的值，这个进程和线程数就是比较合适的值了。系统调用也是，每次调用系统函数，我们的代码就会进入内核空间，导致上下文切换，这个是很耗资源，也要尽量避免频繁调用系统函数。上下文切换次数过多表示你的CPU大部分浪费在上下文切换，导致CPU干正经事的时间少了，CPU没有充分利用，是不可取的。 <br>
us：用户CPU时间占比(%)，例如在做高运算的任务时，如加密解密，那么会导致us很大，这样，r也会变大，造成系统瓶颈。 <br>
sy：系统CPU时间占比(%)，如果太高，表示系统调用时间长，如IO频繁操作。 <br>
id ：空闲 CPU时间占比(%)，一般来说，id + us + sy = 100,一般认为id是空闲CPU使用率，us是用户CPU使用率，sy是系统CPU使用率。 <br>
wt：等待IO的CPU时间。</li>
<li><code>uptime</code> <br>
<img src="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/20160515000046414" alt="Alt text" title=""> <br>
17:53:46为当前时间 <br>
up 158 days,  6:23机器运行时间，时间越大说明你的机器越稳定 <br>
2 users用户连接数，而不是总用户数 <br>
oad average: 0.00, 0.00, 0.00 最近1分钟，5分钟，15分钟的系统平均负载。 <br>
将平均负载值除以核数，如果结果不大于3，那么系统性能较好，如果不大于4那么系统性能可以接受，如果大于5，那么系统性能较差。</li>
<li><code>top</code> <br>
<img src="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/20160515000305629" alt="这里写图片描述" title=""> <br>
top命令用于显示进程信息，top详细见<a href="http://www.cnblogs.com/peida/archive/2012/12/24/2831353.html">http://www.cnblogs.com/peida/archive/2012/12/24/2831353.html</a>  <br>
这里主要关注Cpu(s)统计那一行: <br>
us：用户空间占用CPU的百分比 <br>
sy：内核空间占用CPU的百分比 <br>
ni：改变过优先级的进程占用CPU的百分比 <br>
id： 空闲CPU百分比 <br>
wa： IO等待占用CPU的百分比 <br>
hi：硬中断（Hardware IRQ）占用CPU的百分比 <br>
si：软中断（Software Interrupts）占用CPU的百分比 <br>
从top的结果看CPU负载情况，主要看us和sy，其中us&lt;=70，sy&lt;=35，us+sy&lt;=70说明状态良好，同时可以结合idle值来看，如果id&lt;=70 则表示IO的压力较大。也可以和uptime一样，看第一行。引用[1]</li></ul></li>
<li>分析 <br>
表示系统CPU正常，主要有以下规则： <br>
<ul><li>CPU利用率：us &lt;= 70，sy &lt;= 35，us + sy &lt;= 70。引用[1]</li>
<li>上下文切换：与CPU利用率相关联，如果CPU利用率状态良好，大量的上下文切换也是可以接受的。引用[1]</li>
<li>可运行队列：每个处理器的可运行队列&lt;=3个线程。</li></ul></li>
</ol>



<h4 id="memory"><a name="t5"></a>Memory</h4>

<ol>
<li>说明 <br>
   内存也是系统运行性能的一个很重要的指标，如果一个机器内存不足，那么将会导致进程运行异常而退出。如果进程发生内存泄漏，则会导致大量内存被浪费而无足够可用内存。内存监控一般包括total(机器总内存)、free(机器可用内存)、swap(交换区大小)、cache(缓存大小)等。</li>
<li><p>查看命令</p>

<ul><li><code>vmstat</code> <br>
<img src="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/20160514235813033" alt="Alt text" title=""> <br>
结果各字段解释如下(这里只解释与Memory相关的)： <br>
swpd：虚拟内存已使用的大小，如果大于0，表示你的机器物理内存不足了，如果不是程序内存泄露的原因，那么你该升级内存了或者把耗内存的任务迁移到其他机器，单位为KB。 <br>
free ：空闲的物理内存的大小，我的机器内存总共8G，剩余4457612KB，单位为KB。 <br>
buff：Linux/Unix系统来存储目录里面有什么内容，权限等的缓存，这里大概占用280M，单位为KB。 <br>
cache：cache直接用来记忆我们打开的文件，给文件做缓冲，这里大概占用280M(这里是Linux/Unix的聪明之处，把空闲的物理内存的一部分拿来做文件、目录和进程地址空间的缓存，是为了提高程序执行的性能，当程序使用内存时，buffer/cached会很快地被使用)，单位为KB。 <br>
si： 每秒从磁盘读入虚拟内存的大小，如果这个值大于0，表示物理内存不够用或者内存泄露了，要查找耗内存进程解决掉。本机内存充裕，一切正常，单位为KB。 <br>
so：每秒虚拟内存写入磁盘的大小，如果这个值大于0，同上，单位为KB。</li>
<li><code>free</code> <br>
<img src="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/20160515000640531" alt="这里写图片描述" title=""> <br>
第二行是内存信息，total为机器总内存，used为多少已经使用，free为多少空闲，shared为多个进程共享的内存总额，buffers与cache都是磁盘缓存的大小，分别同vmstat里面的buff与cache. 单位都是M. <br>
第三行是buffers与cache总额的used与free. 单位都是M. <br>
第四行是交换区swap的总额、已用与free. 单位都是M. <br>
区别：第二行(mem)的used/free与第三行(-/+ buffers/cache) used/free的区别。 这两个的区别在于使用的角度来看，第二行是从OS的角度来看，因为对于OS，buffers/cached 都是属于被使用，所以他的可用内存是4353M, 已用内存是3519M, 其中包括，内核（OS）使用+Application(X, oracle,etc)使用的+buffers+cached. <br>
第三行所指的是从应用程序角度来看，对于应用程序来说，buffers/cached 是等于可用的，因为buffer/cached是为了提高文件读取的性能，当应用程序需在用到内存的时候，buffer/cached会很快地被回收。 <br>
所以从应用程序的角度来说，可用内存=系统free memory+buffers+cached。</li>
<li><code>top</code> <br>
<img src="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/20160515000305629" alt="这里写图片描述" title=""> <br>
只关注与内存相关的统计信息，即Mem与Swap行。分别是Mem与Swap的总额、已用量、空闲量、buffers与cache. 这里便验证了buffers是缓存目录里面有什么内容，权限等信息的，而cache是用来swap的缓存的.</li>
<li><code>cat /proc/meminfo</code> <br>
<img src="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/20160515000907615" alt="这里写图片描述" title=""> <br>
主要这几个字段： <br>
MemTotal：内存总额 <br>
MemFree：内存空闲量 <br>
Buffers：同top命令的buffers <br>
Cached：同top命令的cache <br>
SwapToatl：Swap区总大小 <br>
SwapFree：Swap区空闲大小</li></ul></li>
<li><p>分析 <br>
表示系统Mem正常，主要有以下规则：</p>

<ul><li>swap in (si) == 0，swap out (so) == 0</li>
<li>可用内存/物理内存 &gt;= 30%</li></ul></li>
</ol>



<h4 id="磁盘"><a name="t6"></a>磁盘</h4>

<ol>
<li>说明 <br>
   机器的磁盘空间也是一个重要的指标，一旦使用率超过阈值而使得可用不足，那么就需要进行扩容或者清除一些无用的文件。</li>
<li>查看命令 <br>
<ul><li><code>df</code> <br>
<img src="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/20160515001058677" alt="这里写图片描述" title=""> <br>
Filesystem：文件系统的名称 <br>
1K-blocks：1K块的文件系统 <br>
Used：已使用量，单位为KB <br>
Available：空闲量，单位为KB <br>
Use%：已使用占比 <br>
Mounted on：挂载的目录</li></ul></li>
<li>分析 <br>
表示系统磁盘空间正常，主要有以下规则： <br>
<ul><li>Use% &lt;= 90%</li></ul></li>
</ol>



<h4 id="磁盘io"><a name="t7"></a>磁盘I/O</h4>

<ol>
<li>说明 <br>
   机器的磁盘空间也是一个重要的指标，一旦磁盘I/O过重，那么说明运行的进程在大量的文件读写并且cache命中率低。那么一个简单的方法便是增大文件缓存大小来提高命中率从而降低I/O。 <br>
    在Linux中，内核希望能尽可能产生次缺页中断（从文件缓存区读），并且能尽可能避免主缺页中断（从硬盘读），这样随着缺页中断的增多，文件缓存区也逐步增大，直到系统只有少量可用物理内存的时候 Linux 才开始释放一些不用的页。引用[1]</li>
<li>查看命令 <br>
<ul><li><code>vmstat</code> <br>
<img src="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/20160514235813033" alt="Alt text" title=""> <br>
bi ：块设备每秒接收的块数量，这里的块设备是指系统上所有的磁盘和其他块设备，默认块大小1024byte。 <br>
bo：块设备每秒发送的块数量，例如我们读取文件，bo就要大于0。bi和bo一般都要接近0，不然就是IO过于频繁，需要调整。</li>
<li><code>iostat</code> <br>
<img src="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/20160515003136780" alt="这里写图片描述" title=""> <br>
Linux段为机器系统信息： 系统名称、hostname、当前时间、系统版本. <br>
avg-cpu段为cpu的统计信息(平均值)： <br>
%user：用户级别运行所使用的CPU的百分比. <br>
%nice：nice操作所使用的CPU的百分比. <br>
%sys：在系统级别(kernel)运行所使用CPU的百分比. <br>
%iowait：CPU等待硬件I/O时,所占用CPU百分比. <br>
%idle：CPU空闲时间的百分比. <br>
Device段段为设备信息(上图中有两个盘vda与vdb)： <br>
tps: 每秒钟发送到的I/O请求数. <br>
Blk_read/s: 每秒读取的block数. <br>
Blk_wrtn/s: 每秒写入的block数. <br>
Blk_read:   读入的block总数. <br>
Blk_wrtn:  写入的block总数.</li>
<li><code>sar -d 1 1</code> <br>
<img src="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/20160515002632778" alt="Alt text" title=""> <br>
<code>sar -d</code>表示查看磁盘报告 1 1 表示间隔1s，运行1次 <br>
其实cpu、缓存区、文件读写、系统交换区等信息都可以通过该命令查看，只是选项不同，具体参见：<a href="http://blog.chinaunix.net/uid-23177306-id-2531032.html">http://blog.chinaunix.net/uid-23177306-id-2531032.html</a> <br>
第一个段为机器系统信息，同<code>iostat</code> <br>
第二个段为每次运行的dev I/O信息，这里因为只运行一次，并有两个设备dev252-0与dev252-16： <br>
tps：每秒从物理磁盘I/O的次数.多个逻辑请求会被合并为一个I/O磁盘请求,一次传输的大小是不确定的. <br>
rd_sec/s：每秒读扇区数 <br>
wr_sec/s：每秒写扇区数 <br>
avgrq-sz：平均每次设备I/O操作的数据大小 (扇区) <br>
avgqu-sz：平均I/O队列长度 <br>
await：为平均每次设备I/O操作的等待时间(单位ms)，包括请求在队列中的等待时间和服务时间 <br>
svctm：为平均每次设备I/O操作的服务时间(单位ms) <br>
%util：表示一秒中有百分之几的时间用于I/O操作 <br>
如果svctm的值与await很接近，表示几乎没有I/O等待，磁盘性能很好，如果await的值远高于svctm的值，则表示I/O队列等待太长，系统上运行的应用程序将变慢。 <br>
如果%util接近100%，表示磁盘产生的I/O请求太多，I/O系统已经满负荷的在工作，该磁盘请求饱和，可能存在瓶颈。idle小于70% I/O压力就较大了，也就是有较多的I/O。引用[1] <br>
同时可以结合vmstat 查看b参数(等待资源的进程数)和wa参数(IO等待所占用的CPU时间的百分比，高过30%时IO压力高)。引用[1]</li></ul></li>
<li>分析 <br>
表示系统磁盘空间正常，主要有以下规则： <br>
<ul><li>I/O等待的请求比例 &lt;= 20%</li>
<li>提高命中率的一个简单方式就是增大文件缓存区面积，缓存区越大预存的页面就越多，命中率也越高。</li>
<li>Linux 内核希望能尽可能产生次缺页中断（从文件缓存区读），并且能尽可能避免主缺页中断（从硬盘读），这样随着次缺页中断的增多，文件缓存区也逐步增大，直到系统只有少量可用物理内存的时候 Linux 才开始释放一些不用的页。引用[1]</li></ul></li>
</ol>



<h4 id="网络io"><a name="t8"></a>网络I/O</h4>

<ol>
<li><p>说明 <br>
   如果服务器网络连接过多，那么会造成大量的数据包在缓冲区长时间得不到处理，一旦缓冲区不足，便会造成数据包丢失问题，对于TCP，数据包丢失便会进行重传，这有会导致大量的重传；对于UDP，数据包丢失不会进行重传，那么数据便会丢失。因此，服务器的网络连接不宜过多，需要进行监控。 <br>
  服务器一般接收UDP与TCP请求，都是无状态连接，TCP(传输控制协议)是一种提供可靠的数据传输协议，UDP(用户数据报协议)是一种面向无连接的协议，即其传输简单但不可靠。关于它们二者之间的区别，可以查阅相关资料。</p></li>
<li><p>查看命令</p>

<ul><li><code>netstat</code> <br>
<ul><li>UDP <br>
(1) <code>netstat -ludp | grep udp</code> <br>
<img src="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/20160515001423883" alt="这里写图片描述" title=""> <br>
Proto：协议名 <br>
Recv-Q：收到的请求个数 <br>
Send-Q：发送的请求个数 <br>
Local Address：本地地址与端口 <br>
Foreign Address：远程地址与端口 <br>
State：状态 <br>
PID/Program name：进程ID与进程名 <br>
(2) 进一步查看UDP接收的数据包情况 <code>netstat -su</code> <br>
<img src="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/20160515001510290" alt="这里写图片描述" title=""> <br>
画圈的便是UDP数据包丢失统计，该项值增加了，说明存在udp数据包丢失，即网卡收到了，但是应用层没有来得及处理而造成的丢包。</li>
<li>TCP <br>
(1) <code>netstat</code> <br>
<img src="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/20160515001544649" alt="这里写图片描述" title=""> <br>
各字段含义同UDP <br>
(2) 查看重传率 <br>
因为TCP是可靠传输协议，如果数据包丢失会进行重传，因此TCP需要查看其重传率. <br>
<code>cat /proc/net/snmp | grep Tcp</code> <br>
<img src="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/20160515001733009" alt="这里写图片描述" title=""> <br>
那么重传率为RetransSegs/OutSegs</li></ul></li></ul></li>
<li>分析 <br>
UDP丢包率或者TCP重传率不能高于多少，这两个值由系统开发定义，此处，拍脑袋决定UDP包丢包率与TCP包重传率不能超过1%/s。</li>
</ol>



<h4 id="连接数"><a name="t9"></a>连接数</h4>

<ol>
<li>说明 <br>
   对于每一台服务器，都应该限制同时连接数，但是这个阈值又不好确定，因此当监测到系统负载过重时，然后取其连接数，这个值便可作为参考值。</li>
<li>命令 <br>
<ul><li>netstat <br>
<code>netstat -na | sed -n '3,$p' |awk '{print $5}' | grep -v 127\.0\.0\.1 | grep -v 0\.0\.0\.0 | wc -l</code>  <br>
<img src="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/20160515001905244" alt="这里写图片描述" title=""></li></ul></li>
<li>分析 <br>
<ul><li>系统负载过重时，该值作为服务器的峰值参考值。</li>
<li>如果超过1024报警</li></ul></li>
</ol>



<h4 id="文件句柄数"><a name="t10"></a>文件句柄数</h4>

<ol>
<li>说明 <br>
   文件句柄数即当前打开的文件数，对于linux，系统默认支持的最大句柄数是1024，当然每个系统可以不一样，也可以修改，最大不能超过无符号整型最大值(65535)，可以使用ulimit -n命令进行查看，即因此如果同时打开的文件数超过这个数便会发生异常。因此这个指标也需要进行监控。</li>
<li>查看命令 <br>
<ul><li>lsof <br>
<code>lsof -n | awk '{print $1,$2}' | sort | uniq -c | sort -nr</code> <br>
<img src="./Server Monitor服务器监控(包括性能指标与web应用程序)  - CSDN.NET_files/20160515001933604" alt="这里写图片描述" title=""> <br>
三列分别是打开的文件句柄数, 进程名，进程号</li></ul></li>
<li>分析 <br>
将所有的行的第一列相加便是系统目前打开的文件句柄数num，如果num&lt;=max_num*85%则报警。</li>
</ol>



<h4 id="性能指标总结"><a name="t11"></a>性能指标总结</h4>

<ul>
<li>CPU <br>
<ul><li>CPU利用率：us &lt;= 70，sy &lt;= 35，us + sy &lt;= 70。</li>
<li>上下文切换：与CPU利用率相关联，如果CPU利用率状态良好，大量的上下文切换也是可以接受的。</li>
<li>可运行队列：每个处理器的可运行队列&lt;=3个线程。</li></ul></li>
<li>Memory <br>
<ul><li>swap in (si) == 0，swap out (so) == 0</li>
<li>可用内存/物理内存 &gt;= 30%</li></ul></li>
<li>Disk <br>
<ul><li>Use% &lt;= 90%</li></ul></li>
<li>Disk I/O <br>
<ul><li>I/O等待的请求比例 &lt;= 20%</li></ul></li>
<li>Network I/O <br>
<ul><li>UDP包丢包率与TCP包重传率不能超过1%/s。</li></ul></li>
<li>Connect Num <br>
<ul><li>&lt;= 1024</li></ul></li>
<li>File Handle Num <br>
<ul><li>num/max_num &lt;= 90% </li></ul></li>
</ul>



<h3 id="总结"><a name="t12"></a>总结</h3>

<p>    脚本检测nginx、tomcat与webapp运行异常日志(包括nginx与tomcat是否正在运行)与服务器性能七个指标，一旦发现异常信息和性能超标，那么马上发送邮件给管理员，也可以使用云监控push给管理员的云账号。</p>



<h3 id="参考"><a name="t13"></a>参考</h3>

<p>[1]<a href="http://pmghong.blog.51cto.com/3221425/1230423">http://pmghong.blog.51cto.com/3221425/1230423</a> <br>
[2]<a href="http://www.cnblogs.com/peida/tag/linux%E5%91%BD%E4%BB%A4/">http://www.cnblogs.com/peida/tag/linux%E5%91%BD%E4%BB%A4/</a></p></div>
        <script type="text/javascript">
            $(function () {
                $('pre.prettyprint code').each(function () {
                    var lines = $(this).text().split('\n').length;
                    var $numbering = $('<ul></ul>').addClass('pre-numbering').hide();
                    $(this).addClass('has-numbering').parent().append($numbering);
                    for (i = 1; i <= lines; i++) {
                        $numbering.append($('<li></li>').text(i));
                    };
                    $numbering.fadeIn(1700);
                });
            });
        </script>

</div>




</div>







                        <div class="clear">
                        </div>
                    </div>

            </div>

           <div id="side">

    <div class="side">

</div>

    </div>


           </div>

        </div>
